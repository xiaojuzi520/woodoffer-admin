(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-offer-list"],{"15fd":function(n,e,t){"use strict";t("a4d3"),t("c975"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var a=r(t("ccb5"));function r(n){return n&&n.__esModule?n:{default:n}}function i(n,e){if(null==n)return{};var t,r,i=(0,a.default)(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}},"2ccd":function(n,e,t){var a=t("3312");"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var r=t("4f06").default;r("d4588942",a,!0,{sourceMap:!1,shadowMode:!1})},3312:function(n,e,t){var a=t("24fb");e=a(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""]),n.exports=e},"3b0a":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transformObjectEmptyString=void 0;var a=t("961d"),r=function(n){return(0,a.transform)(n,(function(n,e,t){""!==e&&(n[t]=e)}),{})};e.transformObjectEmptyString=r},5197:function(n,e,t){"use strict";t.r(e);var a=t("c1cc"),r=t("c247");for(var i in r)"default"!==i&&function(n){t.d(e,n,(function(){return r[n]}))}(i);t("a21e");var o,c=t("f0c5"),l=Object(c["a"])(r["default"],a["b"],a["c"],!1,null,"4be2bed6",null,!1,a["a"],o);e["default"]=l.exports},"74f8":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoginEnum=e.OriginTypeEnum=e.OperateEnum=e.CurrencyEnum=e.TradeTypeEnum=e.ProductTypeEnum=e.UserStatusEnum=void 0;var a=["激活","关停","待激活"];e.UserStatusEnum=a;var r=["期货","现货"];e.ProductTypeEnum=r;var i=["FOB","CIF"];e.TradeTypeEnum=i;var o=["RMB","USD","EUR"];e.CurrencyEnum=o;var c={create:"创建",update:"更新",delete:"删除"};e.OperateEnum=c;var l={mp:"微信",web:"网页"};e.OriginTypeEnum=l;var u={login:"登录",logout:"退出",register:"注册"};e.LoginEnum=u},"93c4":function(n,e,t){"use strict";(function(n){var a=t("4ea4");t("99af"),t("a15b"),t("d81d"),t("d3b7"),t("4d63"),t("ac1f"),t("25f0"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(t("15fd")),i=a(t("5530")),o=t("74f8"),c=t("3b0a"),l=n.database(),u=(l.command,"offer"),s=(l.collection(u),{data:function(){var n=this;this.$createElement;return{searchForm:{name:"",origin:"",product_type:""},currencyOptions:o.CurrencyEnum.map((function(n,e){return{label:n,value:e}})),collection:"offer,uni-id-users,uni-id-product",dbFields:"_id,product_id{name,type,isDeleted},amount,currency,user_id{nickName, mobile},update_date,create_date",where:{isDeleted:0,"product_id.isDeleted":0},orderby:"create_date desc",pageOptions:{size:20,current:1},selections:[],expData:[],expExcel:{filename:"报价列表.xls",type:"xls",json_fields:{"产品Id":"_id","产品名称":"name","报价金额":"amount","报价币种":"currency","报价人ID":"user_id","报价人":"nickName","报价人手机号":"mobile","创建时间":"create_date"}},tableColumns:[{label:"产品名称",prop:"name",render:function(e,t){var a=t.props.row,r=a.product_id[0],i=function(){var e=["futures","spot"][null===r||void 0===r?void 0:r.type];n.$router.push("/pages/product/".concat(e,"?id=").concat(null===r||void 0===r?void 0:r._id))};return e("el-link",{attrs:{type:"primary"},on:{click:i}},[null===r||void 0===r?void 0:r.name])}},{label:"报价金额",prop:"amount"},{label:"报价币种",prop:"currency"},{label:"报价人",prop:"nickName"},{label:"报价人手机号",prop:"mobile"},{label:"创建时间",prop:"create_date"}]}},methods:{getAllData:function(){var n=this;return l.collection(this.collection).where(this.where).field(this.dbFields).limit(500).get({getCount:!0}).then((function(e){var t=e.result,a=t.count,r=t.data;a>500?n.$message.warning("由于数据库性能原因，导出超过500条时，建议通过控制台进行全量导出"):n.expData=n.formatExcelData(r)})).catch((function(n){console.error(n)}))},formatExcelData:function(n){var e=this;return n.map((function(n){var t,a,r;return(0,i.default)((0,i.default)({},n),{},{create_date:e.$formatDate(n.create_date),currency:o.CurrencyEnum[n.currency],nickName:null===(t=n.user_id[0])||void 0===t?void 0:t.nickName,mobile:null===(a=n.user_id[0])||void 0===a?void 0:a.mobile,user_id:null===(r=n.user_id[0])||void 0===r?void 0:r._id,name:n.product_id[0].name})}))},search:function(){var n=this.searchForm,e=n.name,t=(0,r.default)(n,["name"]),a=(0,i.default)((0,i.default)((0,i.default)({},this.where),t),{},{"product_id.name":new RegExp(e,"i")});this.where=(0,c.transformObjectEmptyString)(a),this.loadData()},loadData:function(){var n=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$nextTick((function(){n.$refs.udb.loadData({clear:e})}))},onPageChanged:function(n){this.pageOptions=n},delTable:function(){var n=this;uni.showModal({title:"提示",content:"确认删除多条记录？",success:function(e){e.confirm&&n.confirmDelete(n.selections)}})},selectionChange:function(n){this.selections=n},confirmDelete:function(n){var e=this,t=n.map((function(n){return"'"+n._id+"'"})).join(",");l.collection(u).where("_id in [".concat(t,"]")).update({isDeleted:1}).then((function(n){e.loadData(!0)})).catch((function(n){uni.showModal({content:n.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))}}});e.default=s}).call(this,t("a9ff")["default"])},a21e:function(n,e,t){"use strict";var a=t("2ccd"),r=t.n(a);r.a},c1cc:function(n,e,t){"use strict";t.d(e,"b",(function(){return r})),t.d(e,"c",(function(){return i})),t.d(e,"a",(function(){return a}));var a={downloadExcel:t("f17b").default,unicloudDb:t("960d").default},r=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",[t("v-uni-view",{staticClass:"uni-header"},[t("v-uni-view",{staticClass:"uni-group hide-on-phone"},[t("v-uni-view",{staticClass:"uni-title"},[n._v("报价管理")]),t("v-uni-view",{staticClass:"uni-sub-title"})],1),t("v-uni-view",{staticClass:"uni-group"},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"warn",size:"mini",disabled:!n.selections.length},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.delTable.apply(void 0,arguments)}}},[n._v("批量删除")]),t("download-excel",{staticClass:"hide-on-phone",attrs:{fields:n.expExcel.json_fields,data:n.expData,beforeGenerate:n.getAllData,type:n.expExcel.type,name:n.expExcel.filename}},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"}},[n._v("导出 Excel")])],1)],1)],1),t("v-uni-view",{staticClass:"search"},[t("el-form",{attrs:{inline:!0,model:n.searchForm}},[t("el-form-item",{attrs:{label:"产品名称"}},[t("el-input",{attrs:{placeholder:"产品名称",clearable:!0},model:{value:n.searchForm.name,callback:function(e){n.$set(n.searchForm,"name",e)},expression:"searchForm.name"}})],1),t("el-form-item",{attrs:{label:"报价金额"}},[t("el-input",{attrs:{placeholder:"报价金额",clearable:!0},model:{value:n.searchForm.amount,callback:function(e){n.$set(n.searchForm,"amount",e)},expression:"searchForm.amount"}})],1),t("el-form-item",{attrs:{label:"报价币种"}},[t("el-select",{attrs:{placeholder:"报价币种",clearable:!0},model:{value:n.searchForm.currency,callback:function(e){n.$set(n.searchForm,"currency",e)},expression:"searchForm.currency"}},n._l(n.currencyOptions,(function(n){return t("el-option",{key:n.value,attrs:{label:n.label,value:n.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.search.apply(void 0,arguments)}}},[n._v("查询")])],1)],1)],1),t("v-uni-view",{staticClass:"uni-container"},[t("unicloud-db",{ref:"udb",attrs:{collection:n.collection,options:n.pageOptions,where:n.where,orderby:n.orderby,getcount:!0,field:n.dbFields,"page-data":"replace","page-size":n.pageOptions.size,"page-current":n.pageOptions.current},scopedSlots:n._u([{key:"default",fn:function(e){var a=e.data,r=e.pagination,i=e.loading;return[t("xl-table",{attrs:{"table-data":n.formatExcelData(a),"table-columns":n.tableColumns,loading:i,selection:!0,count:r.count,"page-size":r.size,"page-no":r.current},on:{"selection-change":function(e){arguments[0]=e=n.$handleEvent(e),n.selectionChange.apply(void 0,arguments)},"change-page":function(e){arguments[0]=e=n.$handleEvent(e),n.onPageChanged.apply(void 0,arguments)}}})]}}])})],1)],1)},i=[]},c247:function(n,e,t){"use strict";t.r(e);var a=t("93c4"),r=t.n(a);for(var i in a)"default"!==i&&function(n){t.d(e,n,(function(){return a[n]}))}(i);e["default"]=r.a},ccb5:function(n,e,t){"use strict";function a(n,e){if(null==n)return{};var t,a,r={},i=Object.keys(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}t("c975"),t("b64b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=a}}]);