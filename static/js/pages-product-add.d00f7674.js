(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-product-add"],{"06a0":function(e,t,r){"use strict";(function(e){var a=r("4ea4");r("caad"),r("d81d"),r("a9e3"),r("d3b7"),r("2532"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(r("5530")),n=(a(r("614e")),r("2f62")),o=e.database(),s=(o.command,"uni-id-product");var u={components:{},data:function(){var e=this;this.$createElement;return{formData:{name:"test",name_en:"test",desc:"test",desc_en:"test",trade_type:0,port_name:"test",port_number:"test",arrive_time:"",carrier:"test",freighter_name:"test",freighter_number:"test",imgUrls:["https://vkceyugu.cdn.bspapp.com/VKCEYUGU-6b121507-e08b-44d2-a95c-b568b76b7844/eea51193-5d06-49b1-b86a-39c3a4393e95.jpg"],status:1},formOptions:[{type:"input",formItem:{label:"产品名称",prop:"name",rules:[this.$rules.required("请输入产品名称")]}},{type:"input",formItem:{label:"产品名称（英文）",prop:"name_en",rules:[this.$rules.required("请输入产品名称（英文）")]}},{type:"select",formItem:{label:"贸易方式",prop:"trade_type",rules:[this.$rules.required("请选择贸易方式")]},attrs:{options:[{label:"FOB",value:0},{label:"CIF",value:1}],default:0}},{type:"input",formItem:{label:"到达港口",prop:"port_name",rules:[this.$rules.required("请输入到达港口")]}},{type:"input",formItem:{label:"到达港口代码",prop:"port_number",rules:[this.$rules.required("请输入到达港口代码")]}},{type:"el-date-picker",formItem:{label:"预计到港日期",prop:"arrive_time",rules:[this.$rules.required("请选择预计到港日期")]},attrs:{type:"date","value-format":"timestamp"}},{type:"input",formItem:{label:"承运商",prop:"carrier",rules:[this.$rules.required("请输入承运商")]}},{type:"input",formItem:{label:"货轮名称",prop:"freighter_name",rules:[this.$rules.required("请输入货轮名称")]}},{type:"input",formItem:{label:"货轮班次",prop:"freighter_number",rules:[this.$rules.required("请输入货轮班次")]}},{type:"custom",formItem:{label:"图片",prop:"imgUrls",rules:[{required:!0,validator:function(t,r,a){e.formData.imgUrls.length?a():a(new Error("请上传图片"))},trigger:["blur","change"]}]},component:{props:{value:{type:Array,default:function(){return[]}}},data:function(){return{}},render:function(e){var t=this,r=function(e){t.$emit("input",e)};return e("div",[e("xl-img-upload",{attrs:{value:this.value,multiple:!0,limit:4},on:{change:r}})])}}},{type:"richText",formItem:{label:"产品描述",prop:"desc",rules:[this.$rules.required("请输入产品描述")]}},{type:"richText",formItem:{label:"产品描述（英文）",prop:"desc_en",rules:[this.$rules.required("请输入产品描述（英文）")]}},{type:"switch",formItem:{label:"是否启用",prop:"status"},attrs:{"active-value":1,"inactive-value":0,"active-text":"开启","inactive-text":"关闭","inactive-color":"#ff001c"}}],data:{},type:0,formDataId:""}},computed:(0,i.default)({},(0,n.mapState)("user",["userInfo"])),onLoad:function(e){if(e){if(e.id){var t=e.id;this.formDataId=t,this.getDetail(t)}e.type&&(this.type=Number(e.type)),console.log(e)}},methods:{submitForm:function(){var e=this;this.$refs.form.validate((function(){e.submit()}))},getDetail:function(e){var t=this;uni.showLoading({mask:!0}),o.collection(s).doc(e).get({getOne:!0}).then((function(e){t.formData=e.result.data,t.type=t.formData.type})).catch((function(e){uni.showModal({content:e.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))},onSuccess:function(e){this.$message.success("上传成功"),console.log("上传成功",e)},onError:function(e){console.error("上传失败",e)},onUpload:function(e,t){var r=t.next;t.done;console.log("上传钩子",e),r()},onRemove:function(e,t){var r=t.next;console.log("删除钩子",e),r(e)},submit:function(){var e=this;uni.showLoading({title:"提交中...",mask:!0});var t=(0,i.default)((0,i.default)({},this.formData),{},{type:this.type,updated_by:this.userInfo._id}),r=o.collection(s);this.formDataId?delete t._id:t.created_by=this.userInfo._id;var a=this.formDataId?r.where({_id:this.formDataId}).update(t):r.add(t);a.then((function(r){e.handleActionRecord((0,i.default)((0,i.default)({},t),{},{id:r.result.id||e.formDataId})),e.formDataId||e.$request("user/sendNewProductMessage",{id:r.result.id}),uni.showToast({title:"提交成功"});var a=0===e.type?"futures":"spot";uni.navigateTo({url:"/pages/product/".concat(a)})})).catch((function(r){e.handleActionRecord(t,0),uni.showModal({content:r.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))},sendNotice:function(){},handleActionRecord:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.formDataId?this.saveProductActionRecord(e,"update",t):(console.log(e),this.saveProductActionRecord(e,"create",t))},saveProductActionRecord:function(e,t,r){o.collection("product-log").add({user_id:this.userInfo._id,product_id:e.id,product_name:e.name,type:t,state:r})},loadPermissions:function(){var e=this;o.collection("uni-id-permissions").limit(500).get().then((function(t){e.permissions=t.result.data.map((function(e){return{value:e.permission_id,text:e.permission_name}}))})).catch((function(e){uni.showModal({title:"提示",content:e.message,showCancel:!1})}))}}};t.default=u}).call(this,r("a9ff")["default"])},"614e":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a={role_id:{rules:[{required:!0,errorMessage:"{label}必填"},{format:"string"}],label:"角色Id"},role_name:{rules:[{required:!0,errorMessage:"{label}必填"},{format:"string"}],label:"角色名"},permission:{rules:[{format:"array"}],label:"权限"},comment:{rules:[{format:"string"}],label:"备注"}};t.default=a},"7a63":function(e,t,r){"use strict";r.r(t);var a=r("06a0"),i=r.n(a);for(var n in a)"default"!==n&&function(e){r.d(t,e,(function(){return a[e]}))}(n);t["default"]=i.a},"8ca5":function(e,t,r){"use strict";var a;r.d(t,"b",(function(){return i})),r.d(t,"c",(function(){return n})),r.d(t,"a",(function(){return a}));var i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("v-uni-view",{staticClass:"uni-container"},[r("xl-form",{ref:"form",attrs:{"form-data":e.formData,"form-options":e.formOptions}}),r("v-uni-view",{staticClass:"uni-button-group"},[r("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.submitForm.apply(void 0,arguments)}}},[e._v("提交")]),r("v-uni-navigator",{staticStyle:{"margin-left":"15px"},attrs:{"open-type":"navigateBack"}},[r("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"}},[e._v("返回")])],1)],1)],1)},n=[]},"9aad":function(e,t,r){"use strict";r.r(t);var a=r("8ca5"),i=r("7a63");for(var n in i)"default"!==n&&function(e){r.d(t,e,(function(){return i[e]}))}(n);var o,s=r("f0c5"),u=Object(s["a"])(i["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],o);t["default"]=u.exports}}]);