(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-product-futures~pages-product-spot"],{"037d":function(n,e,t){var a=t("ef394");"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var r=t("4f06").default;r("145956c2",a,!0,{sourceMap:!1,shadowMode:!1})},"15fd":function(n,e,t){"use strict";t("a4d3"),t("c975"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var a=r(t("ccb5"));function r(n){return n&&n.__esModule?n:{default:n}}function i(n,e){if(null==n)return{};var t,r,i=(0,a.default)(n,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(i[t]=n[t])}return i}},"3a49":function(n,e,t){"use strict";t.r(e);var a=t("9b2d"),r=t("6210");for(var i in r)"default"!==i&&function(n){t.d(e,n,(function(){return r[n]}))}(i);t("6008");var o,u=t("f0c5"),l=Object(u["a"])(r["default"],a["b"],a["c"],!1,null,"6d2497e0",null,!1,a["a"],o);e["default"]=l.exports},"3b0a":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transformObjectEmptyString=void 0;var a=t("961d"),r=function(n){return(0,a.transform)(n,(function(n,e,t){""!==e&&(n[t]=e)}),{})};e.transformObjectEmptyString=r},"3cd9":function(n,e,t){"use strict";(function(n){var a=t("4ea4");t("caad"),t("a15b"),t("d81d"),t("a9e3"),t("d3b7"),t("4d63"),t("ac1f"),t("25f0"),t("2532"),t("5319"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(t("15fd")),i=a(t("5530")),o=t("74f8"),u=a(t("4f78")),l=t("2f62"),d=t("3b0a"),c=n.database(),s=(c.command,"uni-id-product"),f="create_date desc",p={components:{historyTable:u.default},props:{type:{type:Number,default:0},title:{type:String,default:""}},data:function(){var n=this;this.$createElement;return{searchForm:{name:"",status:"",trade_type:""},tradeOptions:o.TradeTypeEnum.map((function(n,e){return{label:n,value:e}})),where:{isDeleted:0,type:this.type},orderby:f,collection:"uni-id-product,uni-id-users",dbFields:"_id,name,name_en,desc,desc_en,trade_type,imgUrls,port_name,port_number,arrive_time,carrier,freighter_name,freighter_number,created_by{username},updated_by{username},status,update_date,create_date",pageOptions:{size:20,current:1},selections:[],expData:[],expExcel:{filename:this.title+".xls",type:"xls",json_fields:{"产品ID":"_id","产品名称":"name","产品名称(英文)":"name_en","贸易方式":"trade_type","到达港口":"port_name","到达港口代码":"port_number","预计到港日期":"arrive_time","承运商":"carrier","货轮名称":"freighter_name","货轮班次":"freighter_number","产品状态":"status","描述":"desc","描述(英文)":"desc_en","最后更新人":"updated_by","最后更新人ID":"updated_by_id","更新时间":"update_date","创建人":"created_by","创建人ID":"created_by_id","创建时间":"create_date"}},tableColumns:[{label:"产品ID",prop:"_id",width:160},{label:"产品名称",prop:"name",width:120},{label:"产品名称(英文)",prop:"name_en",width:120},{label:"贸易方式",width:120,render:function(n,e){var t=e.props.row,a=["success","danger"],r=a[t.trade_type],i=o.TradeTypeEnum[t.trade_type];return n("el-tag",{attrs:{type:r}},[i])}},{label:"到达港口",prop:"port_name",width:120},{label:"到达港口代码",prop:"port_number",width:120},{label:"预计到港日期",prop:"arrive_time",formatter:function(e){return n.$formatDate(e.arrive_time)},width:120},{label:"承运商",prop:"carrier",width:120},{label:"货轮名称",prop:"freighter_name",width:120},{label:"货轮班次",prop:"freighter_number",width:120},{label:"状态",width:160,render:function(n,e){var t=e.props.row,a=1===t.status,r=a?"success":"danger",i=a?"启用":"关闭";return n("el-tag",{attrs:{type:r}},[i])}},{label:"最后更新人",prop:"updated_by",width:120,formatter:function(n){var e;return null===(e=n.updated_by[0])||void 0===e?void 0:e.username}},{label:"更新时间",prop:"update_date",width:160,formatter:function(e){return n.$formatDate(e.update_date)}},{label:"创建人",prop:"created_by",width:120,formatter:function(n){var e;return null===(e=n.created_by[0])||void 0===e?void 0:e.username}},{label:"创建时间",prop:"create_date",width:160,formatter:function(e){return n.$formatDate(e.create_date)}},{label:"操作",width:180,align:"center",fixed:"right",render:function(e,t){var a=t.props.row,r=function(){n.navigateTo("./add?id="+a._id,!1)},i=n.isAdmin?e("el-button",{on:{click:function(){return n.quotePrice(a)}},attrs:{size:"mini",type:"primary"}},["报价信息"]):null;return e("div",{class:"table-action"},[e("el-button",{on:{click:r},attrs:{size:"mini",type:"primary"}},["修改"]),i])}}],showHistoryOffer:!1,product:""}},computed:(0,i.default)((0,i.default)({},(0,l.mapState)("user",["userInfo"])),{},{isAdmin:function(){var n,e;return null===(n=this.userInfo)||void 0===n||null===(e=n.role)||void 0===e?void 0:e.includes("admin")}}),methods:{getAllData:function(){var n=this;return c.collection(this.collection).where(this.where).field(this.dbFields).limit(500).get({getCount:!0}).then((function(e){var t=e.result,a=t.count,r=t.data;a>500?n.$message.warning("由于数据库性能原因，导出超过500条时，建议通过控制台进行全量导出"):n.formatExcelData(r)})).catch((function(n){console.error(n)}))},close:function(){this.showHistoryOffer=!1},quotePrice:function(n){this.showHistoryOffer=!0,this.product=n},formatStatus:function(n){return 1===n?"启用":"关闭"},filterTextContent:function(n){return n.replace(/<[^>]*>|/g,"")},formatExcelData:function(n,e){var t=this;this.expData=n.map((function(n){var e,a,r,u;return(0,i.default)((0,i.default)({},n),{},{create_date:t.$formatDate(n.create_date),arrive_time:t.$formatDate(n.arrive_time),update_date:t.$formatDate(n.update_date),desc:t.filterTextContent(n.desc),desc_en:t.filterTextContent(n.desc_en),status:t.formatStatus(n.status),type:o.ProductTypeEnum[n.type],updated_by:null===(e=n.updated_by[0])||void 0===e?void 0:e.username,created_by:null===(a=n.created_by[0])||void 0===a?void 0:a.username,updated_by_id:null===(r=n.updated_by[0])||void 0===r?void 0:r._id,created_by_id:null===(u=n.created_by[0])||void 0===u?void 0:u._id})}))},search:function(){var n=this.searchForm,e=n.name,t=(0,r.default)(n,["name"]),a=(0,i.default)((0,i.default)((0,i.default)({},this.where),t),{},{name:new RegExp(e,"i")});this.where=(0,d.transformObjectEmptyString)(a),this.loadData()},loadData:function(){var n=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$nextTick((function(){n.$refs.udb.loadData({clear:e})}))},onPageChanged:function(n){this.pageOptions=n},navigateTo:function(n,e){var t=this;uni.navigateTo({url:n,events:{refreshData:function(){t.loadData(e)}}})},add:function(){uni.navigateTo({url:"/pages/product/add?type="+this.type})},delTable:function(){var n=this;uni.showModal({title:"提示",content:"确认删除选中的记录？",success:function(e){e.confirm&&n.confirmDelete(n.selections)}})},selectionChange:function(n){this.selections=n},confirmDelete:function(n){var e=this,t=n.map((function(n){return"'"+n._id+"'"})).join(","),a=n.map((function(n){return n._id})).join(","),r=n.map((function(n){return n.name})).join(","),i={id:a,name:r};c.collection(s).where("_id in [".concat(t,"]")).update({isDeleted:1}).then((function(n){e.loadData(!0),e.saveProductActionRecord(i,"delete",1)})).catch((function(n){e.saveProductActionRecord(i,"delete",0),uni.showModal({content:n.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))},saveProductActionRecord:function(n,e,t){c.collection("product-log").add({user_id:this.userInfo._id,product_id:n.id,product_name:n.name,type:e,state:t})}},created:function(){var n=this.$route.query.id;n&&(this.where._id=n)}};e.default=p}).call(this,t("a9ff")["default"])},"3d01":function(n,e,t){"use strict";t.r(e);var a=t("f5fb"),r=t.n(a);for(var i in a)"default"!==i&&function(n){t.d(e,n,(function(){return a[n]}))}(i);e["default"]=r.a},"4f78":function(n,e,t){"use strict";t.r(e);var a=t("6327"),r=t("3d01");for(var i in r)"default"!==i&&function(n){t.d(e,n,(function(){return r[n]}))}(i);t("f36d");var o,u=t("f0c5"),l=Object(u["a"])(r["default"],a["b"],a["c"],!1,null,"0fe23d9a",null,!1,a["a"],o);e["default"]=l.exports},6008:function(n,e,t){"use strict";var a=t("a326"),r=t.n(a);r.a},6210:function(n,e,t){"use strict";t.r(e);var a=t("3cd9"),r=t.n(a);for(var i in a)"default"!==i&&function(n){t.d(e,n,(function(){return a[n]}))}(i);e["default"]=r.a},6327:function(n,e,t){"use strict";t.d(e,"b",(function(){return r})),t.d(e,"c",(function(){return i})),t.d(e,"a",(function(){return a}));var a={downloadExcel:t("f17b").default,unicloudDb:t("960d").default},r=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("xl-dialog",{ref:"dialog",attrs:{title:n.title,width:"1200px","has-footer":!1},on:{close:function(e){arguments[0]=e=n.$handleEvent(e),n.close.apply(void 0,arguments)}}},[t("div",{staticClass:"offer-header"},[t("download-excel",{staticClass:"hide-on-phone",attrs:{fields:n.expExcel.json_fields,data:n.expData,type:n.expExcel.type,name:n.expExcel.filename,beforeGenerate:n.getAllData}},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"}},[n._v("导出 Excel")])],1)],1),t("unicloud-db",{ref:"udb",attrs:{collection:n.collection,options:n.pageOptions,where:n.where,orderby:n.orderby,getcount:!0,field:n.dbFields,"page-data":"replace","page-size":n.pageOptions.size,"page-current":n.pageOptions.current},scopedSlots:n._u([{key:"default",fn:function(e){var a=e.data,r=e.pagination,i=e.loading;return[t("xl-table",{attrs:{"table-data":n.formatExcelData(a),"table-columns":n.tableColumns,loading:i,count:r.count,"page-size":r.size,"page-no":r.current},on:{"change-page":function(e){arguments[0]=e=n.$handleEvent(e),n.onPageChanged.apply(void 0,arguments)}}})]}}])})],1)},i=[]},"74f8":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoginEnum=e.OriginTypeEnum=e.OperateEnum=e.CurrencyEnum=e.TradeTypeEnum=e.ProductTypeEnum=e.UserStatusEnum=void 0;var a=["激活","关停","待激活"];e.UserStatusEnum=a;var r=["期货","现货"];e.ProductTypeEnum=r;var i=["FOB","CIF"];e.TradeTypeEnum=i;var o=["RMB","USD","EUR"];e.CurrencyEnum=o;var u={create:"创建",update:"更新",delete:"删除"};e.OperateEnum=u;var l={mp:"微信",web:"网页"};e.OriginTypeEnum=l;var d={login:"登录",logout:"退出",register:"注册"};e.LoginEnum=d},"9b2d":function(n,e,t){"use strict";t.d(e,"b",(function(){return r})),t.d(e,"c",(function(){return i})),t.d(e,"a",(function(){return a}));var a={downloadExcel:t("f17b").default,unicloudDb:t("960d").default},r=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",[t("v-uni-view",{staticClass:"uni-header"},[t("v-uni-view",{staticClass:"uni-group hide-on-phone"},[t("v-uni-view",{staticClass:"uni-title"},[n._v(n._s(n.title))]),t("v-uni-view",{staticClass:"uni-sub-title"})],1),t("v-uni-view",{staticClass:"uni-group"},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.add.apply(void 0,arguments)}}},[n._v("新增")]),t("v-uni-button",{staticClass:"uni-button",attrs:{type:"warn",size:"mini",disabled:!n.selections.length},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.delTable.apply(void 0,arguments)}}},[n._v("批量删除")]),t("download-excel",{staticClass:"hide-on-phone",attrs:{fields:n.expExcel.json_fields,data:n.expData,beforeGenerate:n.getAllData,type:n.expExcel.type,name:n.expExcel.filename}},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"}},[n._v("导出 Excel")])],1)],1)],1),t("v-uni-view",{staticClass:"search"},[t("el-form",{attrs:{inline:!0,model:n.searchForm}},[t("el-form-item",{attrs:{label:"产品名称"}},[t("el-input",{attrs:{placeholder:"产品名称",clearable:!0},model:{value:n.searchForm.name,callback:function(e){n.$set(n.searchForm,"name",e)},expression:"searchForm.name"}})],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"状态",clearable:!0},model:{value:n.searchForm.status,callback:function(e){n.$set(n.searchForm,"status",e)},expression:"searchForm.status"}},[t("el-option",{attrs:{label:"关闭",value:0}}),t("el-option",{attrs:{label:"启用",value:1}})],1)],1),t("el-form-item",{attrs:{label:"贸易方式"}},[t("el-select",{attrs:{placeholder:"贸易方式",clearable:!0},model:{value:n.searchForm.trade_type,callback:function(e){n.$set(n.searchForm,"trade_type",e)},expression:"searchForm.trade_type"}},n._l(n.tradeOptions,(function(n){return t("el-option",{key:n.value,attrs:{label:n.label,value:n.value}})})),1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.search.apply(void 0,arguments)}}},[n._v("查询")])],1)],1)],1),t("v-uni-view",{staticClass:"uni-container"},[t("unicloud-db",{ref:"udb",attrs:{collection:n.collection,options:n.pageOptions,where:n.where,field:n.dbFields,"page-data":"replace",orderby:n.orderby,getcount:!0,"page-size":n.pageOptions.size,"page-current":n.pageOptions.current},scopedSlots:n._u([{key:"default",fn:function(e){var a=e.data,r=e.pagination,i=e.loading;e.error;return[t("xl-table",{attrs:{"table-data":a,"table-columns":n.tableColumns,loading:i,selection:!0,count:r.count,"page-size":r.size,"page-no":r.current},on:{"selection-change":function(e){arguments[0]=e=n.$handleEvent(e),n.selectionChange.apply(void 0,arguments)},"change-page":function(e){arguments[0]=e=n.$handleEvent(e),n.onPageChanged.apply(void 0,arguments)}}})]}}])})],1),n.showHistoryOffer?t("history-table",{ref:"historyTable",attrs:{product:n.product},on:{close:function(e){arguments[0]=e=n.$handleEvent(e),n.close.apply(void 0,arguments)}}}):n._e()],1)},i=[]},a326:function(n,e,t){var a=t("f69e");"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var r=t("4f06").default;r("677e299e",a,!0,{sourceMap:!1,shadowMode:!1})},ccb5:function(n,e,t){"use strict";function a(n,e){if(null==n)return{};var t,a,r={},i=Object.keys(n);for(a=0;a<i.length;a++)t=i[a],e.indexOf(t)>=0||(r[t]=n[t]);return r}t("c975"),t("b64b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=a},ef394:function(n,e,t){var a=t("24fb");e=a(!1),e.push([n.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.offer-header[data-v-0fe23d9a]{margin-bottom:20px}',""]),n.exports=e},f36d:function(n,e,t){"use strict";var a=t("037d"),r=t.n(a);r.a},f5fb:function(n,e,t){"use strict";(function(n){var a=t("4ea4");t("d81d"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=a(t("5530")),i=t("2f62"),o=t("74f8"),u=n.database(),l="offer",d=(u.command,{name:"historyTable",props:{product:{type:Object,default:function(){return{}}}},computed:(0,r.default)((0,r.default)({},(0,i.mapState)("user",["userInfo"])),{},{title:function(){return this.product.name+" 的历史报价"},expExcel:function(){return{filename:this.title+".xls",type:"xls",json_fields:{"产品Id":"_id","产品名称":"name","报价金额":"amount","报价币种":"currency","报价人ID":"user_id","报价人":"nickName","报价人手机号":"mobile","创建时间":"create_date"}}}}),data:function(){return{collection:"offer,uni-id-users",dbFields:"_id,amount,currency,user_id{nickName, mobile},update_date,create_date",expData:[],where:{product_id:this.product._id,isDeleted:0},pageOptions:{size:10,current:1},orderby:"create_date desc",data:[],tableColumns:[{label:"产品名称",prop:"name"},{label:"报价金额",prop:"amount"},{label:"报价币种",prop:"currency"},{label:"报价人",prop:"nickName"},{label:"手机号",prop:"mobile"},{label:"创建时间",prop:"create_date"}],loading:!1}},methods:{getAllData:function(){var n=this;return u.collection(this.collection).where(this.where).field(this.dbFields).limit(500).get({getCount:!0}).then((function(e){var t=e.result,a=t.count,r=t.data;a>500?n.$message.warning("由于数据库性能原因，导出超过500条时，建议通过控制台进行全量导出"):n.expData=n.formatExcelData(r)})).catch((function(n){console.error(n)}))},formatExcelData:function(n){var e=this;return n.map((function(n){var t,a,i;return(0,r.default)((0,r.default)({},n),{},{create_date:e.$formatDate(n.create_date),currency:o.CurrencyEnum[n.currency],nickName:null===(t=n.user_id[0])||void 0===t?void 0:t.nickName,mobile:null===(a=n.user_id[0])||void 0===a?void 0:a.mobile,user_id:null===(i=n.user_id[0])||void 0===i?void 0:i._id,name:e.product.name})}))},loadData:function(){var n=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$nextTick((function(){n.$refs.udb.loadData({clear:e})}))},offer:function(){var n=this;u.collection(l).add({product_id:this.product._id,amount:"1000",user_id:this.userInfo._id,currency:0}).then((function(e){n.$message.success("报价成功"),n.getList()}))},onPageChanged:function(n){this.pageOptions=n},close:function(){this.$emit("close")}},mounted:function(){}});e.default=d}).call(this,t("a9ff")["default"])},f69e:function(n,e,t){var a=t("24fb");e=a(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""]),n.exports=e}}]);