(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-productLog-list"],{"0c41":function(n,e,t){"use strict";t.d(e,"b",(function(){return a})),t.d(e,"c",(function(){return o})),t.d(e,"a",(function(){return r}));var r={downloadExcel:t("f17b").default,unicloudDb:t("960d").default},a=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",[t("v-uni-view",{staticClass:"uni-header"},[t("v-uni-view",{staticClass:"uni-group hide-on-phone"},[t("v-uni-view",{staticClass:"uni-title"},[n._v("产品操作日志管理")]),t("v-uni-view",{staticClass:"uni-sub-title"})],1),t("v-uni-view",{staticClass:"uni-group"},[t("download-excel",{staticClass:"hide-on-phone",attrs:{fields:n.expExcel.json_fields,data:n.expData,type:n.expExcel.type,name:n.expExcel.filename,beforeGenerate:n.getAllData}},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"}},[n._v("导出 Excel")])],1)],1)],1),t("v-uni-view",{staticClass:"search"},[t("el-form",{attrs:{inline:!0,model:n.searchForm}},[t("el-form-item",{attrs:{label:"产品名"}},[t("el-input",{attrs:{placeholder:"产品名",clearable:!0},model:{value:n.searchForm.productName,callback:function(e){n.$set(n.searchForm,"productName",e)},expression:"searchForm.productName"}})],1),t("el-form-item",{attrs:{label:"用户名"}},[t("el-input",{attrs:{placeholder:"用户名",clearable:!0},model:{value:n.searchForm.username,callback:function(e){n.$set(n.searchForm,"username",e)},expression:"searchForm.username"}})],1),t("el-form-item",{attrs:{label:"产品类型"}},[t("el-select",{attrs:{placeholder:"产品类型",clearable:!0},model:{value:n.searchForm.productType,callback:function(e){n.$set(n.searchForm,"productType",e)},expression:"searchForm.productType"}},[t("el-option",{attrs:{label:"期货",value:0}}),t("el-option",{attrs:{label:"现货",value:1}})],1)],1),t("el-form-item",{attrs:{label:"操作类型"}},[t("el-select",{attrs:{placeholder:"操作类型",clearable:!0},model:{value:n.searchForm.type,callback:function(e){n.$set(n.searchForm,"type",e)},expression:"searchForm.type"}},n._l(n.operateOptions,(function(n){return t("el-option",{key:n.value,attrs:{label:n.label,value:n.value}})})),1)],1),t("el-form-item",{attrs:{label:"操作结果"}},[t("el-select",{attrs:{placeholder:"操作结果",clearable:!0},model:{value:n.searchForm.state,callback:function(e){n.$set(n.searchForm,"state",e)},expression:"searchForm.state"}},[t("el-option",{attrs:{label:"成功",value:1}}),t("el-option",{attrs:{label:"失败",value:0}})],1)],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.search.apply(void 0,arguments)}}},[n._v("查询")])],1)],1)],1),t("v-uni-view",{staticClass:"uni-container"},[t("unicloud-db",{ref:"udb",attrs:{collection:n.collection,options:n.pageOptions,where:n.where,field:n.dbFields,"page-data":"replace",orderby:n.orderby,getcount:!0,"page-size":n.pageOptions.size,"page-current":n.pageOptions.current},on:{error:function(e){arguments[0]=e=n.$handleEvent(e),n.handleError.apply(void 0,arguments)}},scopedSlots:n._u([{key:"default",fn:function(e){var r=e.data,a=e.pagination,o=e.loading;e.error;return[t("xl-table",{attrs:{"table-data":n.formatExcelData(r),"table-columns":n.tableColumns,loading:o,count:a.count,"page-size":a.size,"page-no":a.current},on:{"change-page":function(e){arguments[0]=e=n.$handleEvent(e),n.onPageChanged.apply(void 0,arguments)}}})]}}])})],1)],1)},o=[]},"15fd":function(n,e,t){"use strict";t("a4d3"),t("c975"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var r=a(t("ccb5"));function a(n){return n&&n.__esModule?n:{default:n}}function o(n,e){if(null==n)return{};var t,a,o=(0,r.default)(n,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(n);for(a=0;a<l.length;a++)t=l[a],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(n,t)&&(o[t]=n[t])}return o}},"341b":function(n,e,t){"use strict";t.r(e);var r=t("b94c"),a=t.n(r);for(var o in r)"default"!==o&&function(n){t.d(e,n,(function(){return r[n]}))}(o);e["default"]=a.a},"3b0a":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.transformObjectEmptyString=void 0;var r=t("961d"),a=function(n){return(0,r.transform)(n,(function(n,e,t){""!==e&&(n[t]=e)}),{})};e.transformObjectEmptyString=a},"74f8":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoginEnum=e.OriginTypeEnum=e.OperateEnum=e.CurrencyEnum=e.TradeTypeEnum=e.ProductTypeEnum=e.UserStatusEnum=void 0;var r=["激活","关停","待激活"];e.UserStatusEnum=r;var a=["期货","现货"];e.ProductTypeEnum=a;var o=["FOB","CIF"];e.TradeTypeEnum=o;var l=["RMB","USD","EUR"];e.CurrencyEnum=l;var u={create:"创建",update:"更新",delete:"删除"};e.OperateEnum=u;var i={mp:"微信",web:"网页"};e.OriginTypeEnum=i;var c={login:"登录",logout:"退出",register:"注册"};e.LoginEnum=c},"97b7":function(n,e,t){"use strict";var r=t("9b9f"),a=t.n(r);a.a},"9b9f":function(n,e,t){var r=t("c03c");"string"===typeof r&&(r=[[n.i,r,""]]),r.locals&&(n.exports=r.locals);var a=t("4f06").default;a("94065bde",r,!0,{sourceMap:!1,shadowMode:!1})},b94c:function(n,e,t){"use strict";(function(n){var r=t("4ea4");t("99af"),t("caad"),t("d81d"),t("b64b"),t("4d63"),t("ac1f"),t("25f0"),t("2532"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(t("15fd")),o=r(t("5530")),l=t("74f8"),u=t("3b0a"),i=n.database(),c="create_date desc",s={data:function(){var n=this;this.$createElement;return{searchForm:{username:"",productName:"",type:"",productType:"",state:""},operateOptions:Object.keys(l.OperateEnum).map((function(n){return{label:l.OperateEnum[n],value:n}})),where:{},collection:"product-log,uni-id-users,uni-id-product",dbFields:"_id,product_id{name,type},user_id{username,mobile},type,ip,state,create_date",orderby:c,pageOptions:{size:20,current:1},selections:[],expData:[],pagination:{},expExcel:{filename:"产品操作日志.xls",type:"xls",json_fields:{"日志ID":"_id","产品ID":"productId","产品名称":"product_name","产品类型":"product_type_str","用户ID":"user_id","用户名称":"username","操作类型":"typeStr","操作结果":"stateStr",IP:"ip","创建时间":"create_date"}},tableColumns:[{label:"ID",prop:"_id",width:120},{label:"产品ID",prop:"productId"},{label:"产品名",prop:"name",render:function(e,t){var r=t.props.row,a=r.product_id[0],o=function(){var e=["futures","spot"][null===a||void 0===a?void 0:a.type];n.$router.push("/pages/product/".concat(e,"?id=").concat(null===a||void 0===a?void 0:a._id))};return e("el-link",{attrs:{type:"primary"},on:{click:o}},[null===a||void 0===a?void 0:a.name])}},{label:"产品类型",width:80,render:function(n,e){var t=e.props.row,r=["","warning"],a=r[t.product_type],o=t.product_type_str;return n("el-tag",{attrs:{effect:"dark",type:a}},[o])}},{label:"操作人",prop:"username"},{label:"操作类型",prop:"type",render:function(n,e){var t=e.props.row,r={create:"success",update:"primary",delete:"danger"},a=r[t.type],o=l.OperateEnum[t.type];return n("el-tag",{attrs:{type:a}},[o])}},{label:"操作结果",prop:"state",render:function(n,e){var t=e.props.row,r=1===t.state,a=r?"success":"danger",o=r?"成功":"失败";return n("el-tag",{attrs:{type:a}},[o])}},{label:"IP",prop:"ip"},{label:"创建时间",prop:"create_date"}]}},methods:{getAllData:function(){var n=this;return i.collection(this.collection).where(this.where).field(this.dbFields).limit(500).get({getCount:!0}).then((function(e){var t=e.result,r=t.count,a=t.data;r>500?n.$message.warning("由于数据库性能原因，导出超过500条时，建议通过控制台进行全量导出"):n.expData=n.formatExcelData(a)})).catch((function(n){console.error(n)}))},formatExcelData:function(n){var e=this;return n.map((function(n){var t,r,a,u,i,c;return(0,o.default)((0,o.default)({},n),{},{create_date:e.$formatDate(n.create_date),user_id:null===(t=n.user_id[0])||void 0===t?void 0:t._id,username:null===(r=n.user_id[0])||void 0===r?void 0:r.username,stateStr:1===n.state?"成功":"失败",typeStr:l.OperateEnum[n.type],productId:null===(a=n.product_id[0])||void 0===a?void 0:a._id,product_name:null===(u=n.product_id[0])||void 0===u?void 0:u.name,product_type:null===(i=n.product_id[0])||void 0===i?void 0:i.type,product_type_str:l.ProductTypeEnum[null===(c=n.product_id[0])||void 0===c?void 0:c.type]})}))},loadData:function(){var n=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$nextTick((function(){n.$refs.udb.loadData({clear:e})}))},handleError:function(n){"SYSTEM_ERROR"===n.code&&n.message&&n.message.includes("timeout")&&this.$message.error("请求超时，请重试")},getReg:function(n){return n?new RegExp(n,"i"):""},search:function(){var n=this.searchForm,e=n.username,t=n.productName,r=n.productType,l=(0,a.default)(n,["username","productName","productType"]),i=this.getReg,c=(0,o.default)((0,o.default)({},l),{},{"product_id.name":i(t),"product_id.type":r,"user_id.username":i(e)});this.where=(0,u.transformObjectEmptyString)(c),this.loadData()},onPageChanged:function(n){this.pageOptions=n}}};e.default=s}).call(this,t("a9ff")["default"])},c03c:function(n,e,t){var r=t("24fb");e=r(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""]),n.exports=e},c4b6:function(n,e,t){"use strict";t.r(e);var r=t("0c41"),a=t("341b");for(var o in a)"default"!==o&&function(n){t.d(e,n,(function(){return a[n]}))}(o);t("97b7");var l,u=t("f0c5"),i=Object(u["a"])(a["default"],r["b"],r["c"],!1,null,"3c7b0086",null,!1,r["a"],l);e["default"]=i.exports},ccb5:function(n,e,t){"use strict";function r(n,e){if(null==n)return{};var t,r,a={},o=Object.keys(n);for(r=0;r<o.length;r++)t=o[r],e.indexOf(t)>=0||(a[t]=n[t]);return a}t("c975"),t("b64b"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=r}}]);