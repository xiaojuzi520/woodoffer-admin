(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system-manager-list"],{"0f70":function(n,e,t){"use strict";var a=t("a370"),i=t.n(a);i.a},"1a5c":function(n,e,t){"use strict";t.r(e);var a=t("9b38"),i=t.n(a);for(var r in a)"default"!==r&&function(n){t.d(e,n,(function(){return a[n]}))}(r);e["default"]=i.a},2601:function(n,e,t){"use strict";t.d(e,"b",(function(){return i})),t.d(e,"c",(function(){return r})),t.d(e,"a",(function(){return a}));var a={downloadExcel:t("f17b").default,unicloudDb:t("960d").default},i=function(){var n=this,e=n.$createElement,t=n._self._c||e;return t("v-uni-view",[t("v-uni-view",{staticClass:"uni-header"},[t("v-uni-view",{staticClass:"uni-group hide-on-phone"},[t("v-uni-view",{staticClass:"uni-title"},[n._v("用户管理")]),t("v-uni-view",{staticClass:"uni-sub-title"})],1),t("v-uni-view",{staticClass:"uni-group"},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.navigateTo("./add")}}},[n._v("新增")]),t("v-uni-button",{staticClass:"uni-button",attrs:{type:"warn",size:"mini",disabled:!n.selectedIndexs.length},on:{click:function(e){arguments[0]=e=n.$handleEvent(e),n.delTable.apply(void 0,arguments)}}},[n._v("批量删除")]),t("download-excel",{staticClass:"hide-on-phone",attrs:{fields:n.expExcel.json_fields,data:n.expData,beforeGenerate:n.getAllData,type:n.expExcel.type,name:n.expExcel.filename}},[t("v-uni-button",{staticClass:"uni-button",attrs:{type:"primary",size:"mini"}},[n._v("导出 Excel")])],1)],1)],1),t("v-uni-view",{staticClass:"uni-container"},[t("unicloud-db",{ref:"udb",attrs:{collection:n.collection,options:n.pageOptions,where:n.where,field:n.dbFields,"page-data":"replace",orderby:n.orderby,getcount:!0,"page-size":n.pageOptions.pageSize,"page-current":n.pageOptions.pageCurrent},scopedSlots:n._u([{key:"default",fn:function(e){var a=e.data,i=e.pagination,r=e.loading;e.error;return[t("xl-table",{attrs:{"table-data":a,"table-columns":n.tableColumns,loading:r,selection:!0,count:i.count,"page-size":i.size,"page-no":i.current},on:{"selection-change":function(e){arguments[0]=e=n.$handleEvent(e),n.selectionChange.apply(void 0,arguments)},"change-page":function(e){arguments[0]=e=n.$handleEvent(e),n.onPageChanged.apply(void 0,arguments)}}})]}}])})],1)],1)},r=[]},"74f8":function(n,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LoginEnum=e.OriginTypeEnum=e.OperateEnum=e.CurrencyEnum=e.TradeTypeEnum=e.ProductTypeEnum=e.UserStatusEnum=void 0;var a=["激活","关停","待激活"];e.UserStatusEnum=a;var i=["期货","现货"];e.ProductTypeEnum=i;var r=["FOB","CIF"];e.TradeTypeEnum=r;var o=["RMB","USD","EUR"];e.CurrencyEnum=o;var s={create:"创建",update:"更新",delete:"删除"};e.OperateEnum=s;var u={mp:"微信",web:"网页"};e.OriginTypeEnum=u;var l={login:"登录",logout:"退出",register:"注册"};e.LoginEnum=l},"97d2":function(n,e,t){"use strict";t.r(e);var a=t("2601"),i=t("1a5c");for(var r in i)"default"!==r&&function(n){t.d(e,n,(function(){return i[n]}))}(r);t("0f70");var o,s=t("f0c5"),u=Object(s["a"])(i["default"],a["b"],a["c"],!1,null,"0e60ccb6",null,!1,a["a"],o);e["default"]=u.exports},"9b38":function(n,e,t){"use strict";(function(n){var a=t("4ea4");t("caad"),t("a15b"),t("d81d"),t("2532"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(t("5530")),r=t("74f8"),o=t("2f62"),s=n.database(),u="register_date desc",l={data:function(){var n=this;this.$createElement;return{collection:"uni-id-users,uni-id-roles",dbFields:"_id,username,role{role_id,role_name},wx_openid,mobile,status,register_date",where:{"role.role_id":s.command.nin(["user"])},orderby:u,pageOptions:{size:20,current:1},selectedIndexs:[],expData:[],expExcel:{filename:"管理人员.xls",type:"xls",json_fields:{"用户名":"username","角色":"role","手机号":"mobile","用户状态":"status","创建时间":"register_date"}},tableColumns:[{label:"用户名",prop:"username"},{label:"角色",prop:"role",formatter:function(n){return n.role.map((function(n){return n.role_name})).join("、")}},{label:"手机号",prop:"mobile"},{label:"操作",render:function(e,t){var a=t.props.row,i=function(){n.navigateTo("./edit?id="+a._id,!1)},r=function(){n.confirmDelete(a._id)};return e("div",{class:"table-action"},[e("el-button",{on:{click:i},attrs:{size:"mini",type:"primary"}},["修改"]),e("el-button",{on:{click:r},attrs:{size:"mini",type:"danger"}},["删除"])])}}]}},computed:(0,i.default)({},(0,o.mapState)("user",["userInfo"])),watch:{},methods:{getAllData:function(){var n=this;return s.collection(this.collection).where(this.where).field(this.dbFields).limit(500).get({getCount:!0}).then((function(e){var t=e.result,a=t.count,i=t.data;a>500?n.$message.warning("由于数据库性能原因，导出超过500条时，建议通过控制台进行全量导出"):n.expData=n.formatExcelData(i)})).catch((function(n){console.error(n)}))},formatExcelData:function(n){var e=this;return n.map((function(n){return(0,i.default)((0,i.default)({},item),{},{role:item.role.map((function(n){return n.role_name})).join("、"),status:e.parseUserStatus(item.status),register_date:e.$formatDate(item.register_date)})}))},loadData:function(){var n=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.$nextTick((function(){n.$refs.udb.loadData({clear:e})}))},onPageChanged:function(n){this.options.pageCurrent=n.current},navigateTo:function(n,e){var t=this;uni.navigateTo({url:n,events:{refreshData:function(){t.loadData(e)}}})},selectedItems:function(){var n=this.$refs.udb.dataList;return this.selectedIndexs.map((function(e){return n[e]._id}))},delTable:function(){var n=this.selectedItems(),e=this.userInfo._id;n.includes(e)?uni.showToast({icon:"none",title:"当前账号不能删除自己",duration:1500}):this.$refs.udb.remove(n)},selectionChange:function(n){this.selectedIndexs=n.detail.index},confirmDelete:function(n){var e=this.userInfo._id;e!==n._id?this.$refs.udb.remove(n._id):uni.showToast({icon:"none",title:"不允许 admin 账号删除自己",duration:1500})},parseUserStatus:function(n){return r.UserStatusEnum[n]}}};e.default=l}).call(this,t("a9ff")["default"])},a370:function(n,e,t){var a=t("ffc2");"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var i=t("4f06").default;i("fd896c60",a,!0,{sourceMap:!1,shadowMode:!1})},ffc2:function(n,e,t){var a=t("24fb");e=a(!1),e.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",""]),n.exports=e}}]);